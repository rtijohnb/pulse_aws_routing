<?xml version="1.0"?>
<dds xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
     xsi:noNamespaceSchemaLocation="https://community.rti.com/schema/6.0.0/rti_routing_service.xsd">

    <!-- ************************************************************************* -->
    <!-- Routing service configuration file for use on the AWS instance used to    -->
    <!-- host the WIS instance for the Pulse demo.  This bridges between a local   -->
    <!-- DDS domain on the AWS instance and a TCP-WAN connection remote Pi-local   -->
    <!-- routing instances.                                                        -->
    <!-- ************************************************************************* -->

    <routing_service name="PulseWis">
	
        <annotation>
		<documentation>Configuration for WIS-side routing service in the Pulse demo. Adjust the public IP addr/port for the known server.</documentation>
		</annotation>

        <!-- Enable remote administration of the routing service from some specified domain -->
        <administration><domain_id>0</domain_id></administration> <!-- !!!ToDo: Not sure if we want this at all... -->

        <domain_route name="Route">

            <participant name="WanParticipant">
                <domain_id>10</domain_id>
                <participant_qos>
                    <transport_builtin>
                        <mask>MASK_NONE</mask>
                    </transport_builtin>
                    <property>
                        <value>
                            <element>
                                <name>dds.transport.load_plugins</name>
                                <value>dds.transport.TCPv4.tcp1</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.library</name>
                                <value>nddstransporttcp</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.create_function</name>
                                <value>NDDS_Transport_TCPv4_create</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.parent.classid</name>
                                <value>NDDS_TRANSPORT_CLASSID_TCPV4_WAN</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.public_address</name>
                                <value>50.18.214.8:9900</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.server_bind_port</name>
                                <value>9900</value>
                            </element>
                            <element>
                                <name>dds.transport.TCPv4.tcp1.disable_nagle</name>
                                <value>1</value>
                            </element>
                        </value>
                    </property>
                </participant_qos>
            </participant>

            <participant name="LocalParticipant">
                <domain_id>20</domain_id>
            </participant>

            <session name="Session" enabled="true">

                <auto_topic_route name="ForwardConfigToPi" enabled="true">
                    <publish_with_original_info>true</publish_with_original_info>                    
                    <input participant="LocalParticipant">
                        <allow_topic_name_filter>PatientConfigTopic</allow_topic_name_filter>
                        <datareader_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>5</depth>
                            </history>
						    <!-- !!!ToDo: update as required -->
                        </datareader_qos>
                    </input>
                    <output participant="WanParticipant">
                        <allow_topic_name_filter>PatientConfigTopic</allow_topic_name_filter>
						<datawriter_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>5</depth>
                            </history>
						</datawriter_qos>
                    </output>
                </auto_topic_route>

                <auto_topic_route name="ForwardPulseFromPi" enabled="true">
                    <publish_with_original_info>true</publish_with_original_info>
                    <input participant="WanParticipant">
                        <allow_topic_name_filter>PatientPulseTopic</allow_topic_name_filter>
                        <datareader_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>100</depth>
                            </history>
						<!-- !!!ToDo: update as required; this is coming from the TCP tunnel so probably not much needed? -->
                        </datareader_qos>
                    </input>
                    <output participant="LocalParticipant">
                        <allow_topic_name_filter>PatientPulseTopic</allow_topic_name_filter>
                        <datawriter_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>100</depth>
                            </history>
						    <!-- !!!ToDo: update as required -->
                        </datawriter_qos>
                    </output>
                </auto_topic_route>
				
                <auto_topic_route name="ForwardInfoFromPi" enabled="true">
                    <input participant="WanParticipant">
                        <allow_topic_name_filter>PatientInfoTopic</allow_topic_name_filter>
                        <datareader_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>2</depth>
                            </history>
						<!-- !!!ToDo: update as required; this is coming from the TCP tunnel so probably not much needed? -->
                        </datareader_qos>
                    </input>
                    <output participant="LocalParticipant">
                        <allow_topic_name_filter>PatientInfoTopic</allow_topic_name_filter>
                        <datawriter_qos>
							<reliability>
								<kind>RELIABLE_RELIABILITY_QOS</kind>
							</reliability>
                            <history>
                                <kind>KEEP_LAST_HISTORY_QOS</kind>
                                <depth>2</depth>
                            </history>
						    <!-- !!!ToDo: update as required -->
                        </datawriter_qos>
                    </output>
                </auto_topic_route>

            </session>
        </domain_route>
    </routing_service>
</dds>
